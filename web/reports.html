<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>ZLAGODA ‚Äî –ó–≤—ñ—Ç–∏</title>

  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,300,600,700">

  <!-- Bootstrap + Custom Styles -->
  <link rel="stylesheet" href="static/bootstrap.min.css">
  <link rel="stylesheet" href="static/style.css">
  <link rel="stylesheet" href="static/sidebar-menu.css">
  <link rel="stylesheet" href="static/custom.css">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">

  <style>
    .logout-btn-fixed {
    position: absolute;
    bottom: 0;
    width: 100%;
    @media (min-width: 992px) {
      #mySidebar {
        display: block !important;
        width: 200px;
        position: fixed;
        height: 100%;
        z-index: 1000;
      }
      #main {
        margin-left: 250px;
      }
      #openNav {
        display: none !important;
      }
    }

    @media (max-width: 991px) {
      #main {
        margin-left: 0;
      }
    }

    table {
      border-collapse: collapse;
      margin-top: 20px;
      width: 100%;
    }

    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #eee;
    }

    @media print {
      button, .no-print, .w3-sidebar {
        display: none !important;
      }
      #main {
        margin: 0 !important;
      }
    }
  </style>

</head>
<body class="tooltips">

<!-- Sidebar -->
<!-- Sidebar -->
<!-- Sidebar -->
<!-- Sidebar -->
<div id="mySidebar"
     class="w3-sidebar w3-bar-block w3-card w3-animate-left w3-light-grey"
     style="display: none;">
  <button class="w3-bar-item w3-button w3-large w3-hide-large" onclick="w3_close()">‚úï Close</button>

  <!-- Workers (—Ç—ñ–ª—å–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä) -->
  <a href="/manage-employee" class="w3-bar-item w3-button role-manager">Workers</a>

  <!-- Manage Products (—ñ –º–µ–Ω–µ–¥–∂–µ—Ä, —ñ –∫–∞—Å–∏—Ä) -->
  <a href="/manage_product"
     class="w3-bar-item w3-button role-manager role-cashier">
    Manage Products
  </a>

  <!-- Store Products (—ñ –º–µ–Ω–µ–¥–∂–µ—Ä, —ñ –∫–∞—Å–∏—Ä) -->
  <a href="/manage_store_product"
     class="w3-bar-item w3-button role-manager role-cashier">
    Store Products
  </a>

  <!-- Categories (—Ç—ñ–ª—å–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä) -->
  <a href="/manage_category" class="w3-bar-item w3-button role-manager">
    Categories
  </a>

  <!-- Customers (—ñ –º–µ–Ω–µ–¥–∂–µ—Ä, —ñ –∫–∞—Å–∏—Ä) -->
  <a href="/manage_customer"
     class="w3-bar-item w3-button role-manager role-cashier">
    Customers
  </a>

  <!-- Checks (—ñ –º–µ–Ω–µ–¥–∂–µ—Ä, —ñ –∫–∞—Å–∏—Ä) -->
  <a href="/manage_check"
     class="w3-bar-item w3-button role-manager role-cashier">
    Checks
  </a>

  <!-- Reports (—Ç—ñ–ª—å–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä) -->
  <a href="/reports" class="w3-bar-item w3-button role-manager">Reports</a>

  <a href="/manager_account.html" class="w3-bar-item w3-button role-manager">My Account</a>
<a href="/cashier_account.html" class="w3-bar-item w3-button role-cashier">My Account</a>
<a href="/logout" class="w3-bar-item w3-button logout-btn-fixed">Log Out</a>


</div>




<!-- Main Content -->
<div id="main">
  <div class="container">
    <div class="right content-page">
      <div class="body content rows scroll-y">
        <div class="box-info full">
          <h2 class="no-print">–ó–≤—ñ—Ç–∏</h2>

          <!-- Buttons -->
          <div class="no-print">
            <button onclick="loadReport('employees')" class="btn btn-default">üßç –ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∏</button>
            <button onclick="loadReport('customers')" class="btn btn-default">ü™™ –ö–ª—ñ—î–Ω—Ç–∏</button>
            <button onclick="loadReport('categories')" class="btn btn-default">üóÇÔ∏è –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</button>
            <button onclick="loadReport('products')" class="btn btn-default">üì¶ –¢–æ–≤–∞—Ä–∏</button>
            <button onclick="loadReport('store-products')" class="btn btn-default">üõí –¢–æ–≤–∞—Ä–∏ —É –º–∞–≥–∞–∑–∏–Ω—ñ</button>
            <button onclick="loadReport('receipts')" class="btn btn-default">üßæ –ß–µ–∫–∏</button>
            <button onclick="printReport()" class="btn btn-primary">üñ®Ô∏è –î—Ä—É–∫ –∑–≤—ñ—Ç—É</button>
          </div>

          <!-- Report Title -->
          <h3 id="report-title" class="mt-4"></h3>

          <!-- Output -->
          <div id="report-output" class="mt-3"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="js/package/jquery.min.js"></script>
<script src="js/package/bootstrap.min.js"></script>

<script>
  function loadReport(type) {
    const endpoints = {
      'employees': '/api/reports/employees',
      'customers': '/api/reports/customers',
      'categories': '/api/reports/categories',
      'products': '/api/reports/products',
      'store-products': '/api/reports/store-products',
      'receipts': '/api/reports/receipts',
    };

    const titles = {
      'employees': '–ó–≤—ñ—Ç –ø–æ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞—Ö',
      'customers': '–ó–≤—ñ—Ç –ø–æ –∫–ª—ñ—î–Ω—Ç–∞—Ö',
      'categories': '–ó–≤—ñ—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö',
      'products': '–ó–≤—ñ—Ç –ø–æ —Ç–æ–≤–∞—Ä–∞—Ö',
      'store-products': '–ó–≤—ñ—Ç –ø–æ —Ç–æ–≤–∞—Ä–∞—Ö —É –º–∞–≥–∞–∑–∏–Ω—ñ',
      'receipts': '–ó–≤—ñ—Ç –ø–æ —á–µ–∫–∞—Ö',
    };

    if (!endpoints[type]) {
      alert('–ù–µ–≤—ñ–¥–æ–º–∏–π —Ç–∏–ø –∑–≤—ñ—Ç—É');
      return;
    }

    fetch(endpoints[type])
      .then(res => {
        if (!res.ok) throw new Error(`–ü–æ–º–∏–ª–∫–∞ ${res.status}`);
        return res.json();
      })
      .then(data => {
        document.getElementById('report-title').innerText = titles[type];
        document.getElementById('report-output').innerHTML = generateTable(data);
      })
      .catch(err => {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–≤—ñ—Ç—É:', err);
        document.getElementById('report-output').innerHTML = '<p style="color:red;">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–≤—ñ—Ç.</p>';
      });
  }

  function generateTable(data) {
    if (!Array.isArray(data) || data.length === 0) {
      return '<p>–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è.</p>';
    }

    // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–∑–≤ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞
    const columnNames = {
      'id_employee': 'Employee ID',
      'empl_surname': 'Surname',
      'empl_name': 'Name',
      'empl_patronymic': 'Patronymic',
      'empl_role': 'Role',
      'salary': 'Salary',
      'date_of_birth': 'Birthday',
      'date_of_start': 'Start Date',
      'phone_number': 'Phone',
      'city': 'City',
      'street': 'Street',
      'zip_code': 'ZIP',

      'card_number': 'Card Number',
      'cust_surname': 'Surname',
      'cust_name': 'Name',
      'cust_patronymic': 'Patronymic',
      'phone_number': 'Phone',
      'city': 'City',
      'street': 'Street',
      'zip_code': 'ZIP',
      'percent': 'Discount %',

      'category_number': 'Category ID',
      'category_name': 'Category Name',

      'id_product': 'Product ID',
      'product_name': 'Product Name',
      'characteristics': 'Characteristics',
      'producer': 'Producer',
      'category_number': 'Category ID',

      'UPC': 'UPC',
      'id_product': 'Product ID',
      'selling_price': 'Price',
      'products_number': 'Quantity',
      'promotional_product': 'Promo',

      'check_number': 'Check #',
      'print_date': 'Printed',
      'sum_total': 'Total',
      'vat': 'VAT',
    };

    // –í–∏—Ç—è–≥—É—î–º–æ –≤—Å—ñ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –∫–ª—é—á—ñ –∑ —É—Å—ñ—Ö —Ä—è–¥–∫—ñ–≤
    const keysSet = new Set();
    data.forEach(row => Object.keys(row).forEach(key => keysSet.add(key)));

    // –ü–æ—Ä—è–¥–æ–∫: —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID ‚Üí —Ä–µ—à—Ç–∞ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
    const idKeys = ['id_employee', 'card_number', 'category_number', 'id_product', 'UPC', 'check_number'];
    const otherKeys = [...keysSet].filter(k => !idKeys.includes(k)).sort();
    const finalKeys = idKeys.filter(k => keysSet.has(k)).concat(otherKeys);

    let html = '<table><thead><tr>';
    finalKeys.forEach(key => {
      html += `<th>${columnNames[key] || key}</th>`;
    });
    html += '</tr></thead><tbody>';

    data.forEach(row => {
      html += '<tr>';
      finalKeys.forEach(key => {
        html += `<td>${row[key] !== null ? row[key] : ''}</td>`;
      });
      html += '</tr>';
    });

    html += '</tbody></table>';
    return html;
    }


  function printReport() {
    window.print();
  }
</script>



</body>
</html>

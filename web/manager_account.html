<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,300,600,700">

    <!-- Bootstrap + Custom Styles -->
    <link rel="stylesheet" href="web/static/bootstrap.min.css">
    <link rel="stylesheet" href="web/static/style.css">
    <link rel="stylesheet" href="web/static/sidebar-menu.css">
    <link rel="stylesheet" href="web/static/custom.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">

    <style>
        .logout-btn-fixed {
    position: absolute;
    bottom: 0;
    width: 100%;
    }
        /* Always visible sidebar on desktop */
        @media (min-width: 992px) {
            #mySidebar {
                display: block !important;
                width: 200px;
                position: fixed;
                height: 100%;
                z-index: 1000;
            }
            #main {
                margin-left: 250px;
            }
            #openNav {
                display: none !important;
            }
        }

        /* Content margin reset on small screens */
        @media (max-width: 991px) {
            #main {
                margin-left: 0;
            }
        }
    </style>

</head>
<body class="tooltips">

<!-- Sidebar -->
<div class="w3-sidebar w3-bar-block w3-card w3-animate-left w3-light-grey" style="display:none;" id="mySidebar">
    <button class="w3-bar-item w3-button w3-large w3-hide-large" onclick="w3_close()">‚úï Close</button>
    <a href="/manage-employee" class="w3-bar-item w3-button role-manager">Workers</a>
    <a href="/manage_product" class="w3-bar-item w3-button role-manager">Manage Products</a>
    <a href="/manage_store_product" class="w3-bar-item w3-button role-manager">Store Products</a>
    <a href="/manage_category" class="w3-bar-item w3-button role-manager">Categories</a>
    <a href="/manage_customer" class="w3-bar-item w3-button role-manager">Customers</a>
    <a href="/manage_check" class="w3-bar-item w3-button role-manager">Checks</a>
    <a href="/reports" class="w3-bar-item w3-button role-manager">Reports</a>
    <a href="/manager_account.html" class="w3-bar-item w3-button role-manager">My Account</a>
<a href="/cashier_account.html" class="w3-bar-item w3-button role-cashier">My Account</a>
<a href="/logout" class="w3-bar-item w3-button logout-btn-fixed">Log Out</a>

</div>

<!-- Main Content -->
<div id="main" style="padding:20px;">
    <button id="openNav" class="w3-button w3-teal w3-xlarge w3-hide-large" onclick="w3_open()">‚ò∞</button>

    <h2>–ö–∞–±—ñ–Ω–µ—Ç –ú–µ–Ω–µ–¥–∂–µ—Ä–∞</h2>
    <p><strong>–Ü–º‚Äô—è:</strong> <span id="empl_name"></span></p>
    <p><strong>–ü—Ä—ñ–∑–≤–∏—â–µ:</strong> <span id="empl_surname"></span></p>
    <p><strong>–†–æ–ª—å:</strong> <span id="empl_role"></span></p>

    <button class="btn btn-info mt-3" onclick="viewFullInfo()">View Info</button>

    <!-- üëá –î–æ–¥–∞–Ω–æ –Ω–æ–≤–∏–π –±–ª–æ–∫ –¥–ª—è –≤–∏–≤–æ–¥—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó -->
    <div id="infoOutput" class="mt-4 border rounded p-3 bg-light" style="display: none;"></div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function viewFullInfo() {
    const infoBox = document.getElementById('infoOutput');
    const button = document.querySelector('button.btn.btn-info');

    if (infoBox.style.display === 'block') {
        infoBox.style.display = 'none';
        button.innerText = 'View Info';
        return;
    }

    fetch('/api/employee_full_info', {
        method: 'GET',
        credentials: 'include'
    })
    .then(res => {
        if (!res.ok) throw new Error("Server error");
        return res.json();
    })
    .then(data => {
        let output = '';
        if (!data.success) {
            output = `<p class="text-danger">${data.message || '–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.'}</p>`;
        } else {
            const fields = [
                ['ID', data.id_employee],
                ['–Ü–º‚Äô—è', data.empl_name],
                ['–ü—Ä—ñ–∑–≤–∏—â–µ', data.empl_surname],
                ['–ü–æ –±–∞—Ç—å–∫–æ–≤—ñ', data.empl_patronymic],
                ['–†–æ–ª—å', data.empl_role],
                ['–ó–∞—Ä–ø–ª–∞—Ç–∞', data.salary != null ? parseFloat(data.salary).toFixed(2) : null],
                ['–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è', data.date_of_birth ? new Date(data.date_of_birth).toLocaleDateString() : null],
                ['–î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É —Ä–æ–±–æ—Ç–∏', data.date_of_start ? new Date(data.date_of_start).toLocaleDateString() : null],
                ['–¢–µ–ª–µ—Ñ–æ–Ω', data.phone_number?.trim()],
                ['–ê–¥—Ä–µ—Å–∞', (data.city && data.street && data.zip_code) ? `${data.city}, ${data.street}, ${data.zip_code}` : null]
            ];

            output = fields
                .filter(([_, value]) => value && value !== '')
                .map(([label, value]) => `<p><strong>${label}:</strong> ${value}</p>`)
                .join('');
        }

        infoBox.innerHTML = output;
        infoBox.style.display = 'block';
        button.innerText = 'Hide Info';
    })
    .catch(err => {
        console.error('Error fetching full employee info:', err);
        infoBox.innerHTML = '<p class="text-danger">–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö.</p>';
        infoBox.style.display = 'block';
        button.innerText = 'Hide Info';
    });
}


function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
    document.getElementById("main").style.marginLeft = "200px";
    document.getElementById("openNav").style.display = "none";
}
function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
    document.getElementById("main").style.marginLeft = "0";
    document.getElementById("openNav").style.display = "inline-block";
}

fetch('/api/current_employee', {
    method: 'GET',
    credentials: 'include'
})
.then(res => res.json())
.then(data => {
    document.getElementById('empl_name').innerText = data.empl_name || '';
    document.getElementById('empl_surname').innerText = data.empl_surname || '';
    document.getElementById('empl_role').innerText = data.empl_role || '';
    const role = data.empl_role?.toLowerCase();
    document.querySelectorAll('[class*="role-"]').forEach(el => {
        if (!el.classList.contains(`role-${role}`)) {
            el.style.display = 'none';
        }
    });
})
.catch(err => console.error('Failed to load employee info:', err));
</script>

</body>
</html>
